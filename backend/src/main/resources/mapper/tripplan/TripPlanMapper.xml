<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pjt.planit.tripplan.mapper.PlanMapper">
    <select id="getPlanList" parameterType="com.pjt.planit.tripplan.dto.PlanDto" resultType="hashmap">
        SELECT *
        , CASE WHEN A.cust_no = 2 THEN 'Y' ELSE 'N' END AS ownerYn
        FROM (
            SELECT ttp.*
            FROM T_TRIP_PLAN ttp
            WHERE ttp.cust_no = #{custNo}
            AND ttp.start_dt BETWEEN #{startDt} AND #{endDt}
            UNION ALL
            SELECT ttp2.*
            FROM T_TRIP_PLAN ttp2
            INNER JOIN T_TRIP_MATE ttm
            ON ttm.trip_plan_no = ttp2.trip_plan_no
            WHERE ttm.cust_no = #{custNo}
            AND ttp2.start_dt BETWEEN #{startDt} AND #{endDt}
        ) AS A
        ORDER BY A.start_dt DESC
    </select>
</mapper>
